from typing import List, Dict

# Map different scanner outputs into a unified schema
NORMALIZATION_MAP = {
    "codeql": "static_code_analysis",
    "semgrep": "static_code_analysis",
    "sonarqube": "static_code_analysis",
    "snyk": "dependency_scan",
    "trivy": "container_scan",
    "nuclei": "infrastructure_scan",
    "zap": "dynamic_scan",
    "mobSF": "mobile_scan"
}

def normalize_vulnerabilities(raw_results: List[Dict]) -> List[Dict]:
    normalized = []
    for item in raw_results:
        tool = item.get("tool", "unknown").lower()
        normalized.append({
            "scanner": tool,
            "category": NORMALIZATION_MAP.get(tool, "other"),
            "file": item.get("file"),
            "line": item.get("line"),
            "severity": item.get("severity"),
            "description": item.get("description"),
            "recommendation": item.get("recommendation")
        })
    return normalized
def categorize(tool_name: str) -> str:
    """
    Map scanner to vulnerability category.
    """
    tool_name = tool_name.lower()
    if tool_name in ["codeql", "semgrep", "snyk"]:
        return "static_code_analysis"
    if tool_name in ["owasp zap", "stackhawk", "nuclei"]:
        return "dynamic_analysis"
    if tool_name in ["checkov", "tfsec", "trivy"]:
        return "infrastructure"
    return "other"