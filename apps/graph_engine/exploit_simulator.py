from attack_graph import AttackGraph

class ExploitSimulator:
    def __init__(self, attack_graph: AttackGraph):
        self.graph = attack_graph

    def simulate(self):
        """
        Simulate all attack paths and calculate blast radius
        """
        all_paths = []
        for node_id in self.graph.nodes:
            paths = self.graph.simulate_attack_path(node_id)
            all_paths.extend(paths)

        # Calculate severity-weighted paths
        simulation_results = []
        for path in all_paths:
            severity_score = sum(self._severity_value(self.graph.nodes[n].severity) for n in path)
            simulation_results.append({
                "path": path,
                "severity_score": severity_score
            })
        return simulation_results

    @staticmethod
    def _severity_value(severity: str) -> int:
        mapping = {"low": 1, "medium": 3, "high": 5, "critical": 8}
        return mapping.get(severity.lower(), 0)
